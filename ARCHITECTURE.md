# Architecture Diagram

## Component Flow

```
┌─────────────────────────────────────────────────────────────────────┐
│                           User Device                                │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │                       MainActivity                            │  │
│  │  ┌────────────────────────────────────────────────────────┐  │  │
│  │  │ • Request SYSTEM_ALERT_WINDOW permission              │  │  │
│  │  │ • Request PACKAGE_USAGE_STATS permission              │  │  │
│  │  │ • Start/Stop OverlayService                           │  │  │
│  │  │ • Display service status                              │  │  │
│  │  └────────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────┬───────────────────────────────────┘  │
│                             │ starts/stops                          │
│                             ▼                                       │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │                    OverlayService                            │  │
│  │  ┌────────────────────────────────────────────────────────┐  │  │
│  │  │ Foreground Service (persistent)                        │  │  │
│  │  │                                                        │  │  │
│  │  │ ┌─────────────────────────────────────────────────┐  │  │  │
│  │  │ │ Monitoring Loop (every 1 second):              │  │  │  │
│  │  │ │                                                 │  │  │  │
│  │  │ │ 1. Query UsageStatsManager                     │  │  │  │
│  │  │ │    ↓                                            │  │  │  │
│  │  │ │ 2. Get foreground app package name             │  │  │  │
│  │  │ │    ↓                                            │  │  │  │
│  │  │ │ 3. Is it "com.supercell.clashroyale"?          │  │  │  │
│  │  │ │    ├── Yes → Show overlay                      │  │  │  │
│  │  │ │    └── No  → Hide overlay                      │  │  │  │
│  │  │ └─────────────────────────────────────────────────┘  │  │  │
│  │  │                                                        │  │  │
│  │  │ WindowManager: Display overlay view                   │  │  │
│  │  └────────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                             │                                       │
│                             │ overlay shown when detected           │
│                             ▼                                       │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │                    Clash Royale App                          │  │
│  │                                                              │  │
│  │  ┌────────────────────────────────────────────────────────┐  │  │
│  │  │                                                        │  │  │
│  │  │         [Clash Royale Game Screen]                    │  │  │
│  │  │                                                        │  │  │
│  │  │  ┌──────────────────────────────────────────────┐    │  │  │
│  │  │  │ ╔════════════════════════════════════════╗   │    │  │  │
│  │  │  │ ║      Clasher Engine Overlay           ║   │    │  │  │
│  │  │  │ ║                                        ║   │    │  │  │
│  │  │  │ ║    Clasher Engine                      ║   │    │  │  │
│  │  │  │ ║    Clash Royale Detected!              ║   │    │  │  │
│  │  │  │ ╚════════════════════════════════════════╝   │    │  │  │
│  │  │  └──────────────────────────────────────────────┘    │  │  │
│  │  │                                                        │  │  │
│  │  └────────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────┘
```

## Sequence Diagram

```
User          MainActivity    OverlayService    UsageStatsManager    WindowManager    Clash Royale
 │                 │                 │                  │                  │               │
 │─Launch App──────>│                 │                  │                  │               │
 │                 │                 │                  │                  │               │
 │                 │─Check Permissions│                  │                  │               │
 │<─Request Perms──│                 │                  │                  │               │
 │                 │                 │                  │                  │               │
 │─Grant Perms─────>│                 │                  │                  │               │
 │                 │                 │                  │                  │               │
 │─Tap Start───────>│                 │                  │                  │               │
 │                 │─Start Service──>│                  │                  │               │
 │                 │                 │                  │                  │               │
 │                 │                 │─Create Foreground│                  │               │
 │                 │                 │  Notification    │                  │               │
 │                 │                 │                  │                  │               │
 │                 │                 │─Start Monitoring │                  │               │
 │                 │                 │  Loop (1s)       │                  │               │
 │                 │                 │                  │                  │               │
 │                 │                 │──Query Stats────>│                  │               │
 │                 │                 │<─Current App─────│                  │               │
 │                 │                 │  (other app)     │                  │               │
 │                 │                 │                  │                  │               │
 │                 │                 │ [Wait 1 second]  │                  │               │
 │                 │                 │                  │                  │               │
 │─Launch─────────────────────────────────────────────────────────────────────────────────>│
 │                 │                 │                  │                  │               │
 │                 │                 │──Query Stats────>│                  │               │
 │                 │                 │<─Current App─────│                  │               │
 │                 │                 │  (Clash Royale)  │                  │               │
 │                 │                 │                  │                  │               │
 │                 │                 │─Show Overlay────────────────────────>│               │
 │                 │                 │                  │<─Display View────│               │
 │                 │                 │                  │                  │               │
 │<──────────────────────────────────────────[Overlay Visible]──────────────────────────────│
 │                 │                 │                  │                  │               │
 │─Switch to Home──────────────────────────────────────────────────────────────────────────│
 │                 │                 │                  │                  │               │
 │                 │                 │──Query Stats────>│                  │               │
 │                 │                 │<─Current App─────│                  │               │
 │                 │                 │  (home screen)   │                  │               │
 │                 │                 │                  │                  │               │
 │                 │                 │─Hide Overlay────────────────────────>│               │
 │                 │                 │                  │<─Remove View─────│               │
```

## Permission Flow

```
┌─────────────────────────────────────────────────────────────┐
│                    App First Launch                         │
└─────────────────────┬───────────────────────────────────────┘
                      │
                      ▼
         ┌─────────────────────────┐
         │ Check SYSTEM_ALERT_WINDOW│
         │      Permission          │
         └────────┬────────┬────────┘
                  │        │
         Not Granted      Granted
                  │        │
                  ▼        │
    ┌──────────────────────┐│
    │ Request Permission   ││
    │ (Launch Settings)    ││
    └────────┬─────────────┘│
             │              │
        User grants         │
             │              │
             └──────┬───────┘
                    │
                    ▼
         ┌─────────────────────────┐
         │ Check PACKAGE_USAGE_STATS│
         │      Permission          │
         └────────┬────────┬────────┘
                  │        │
         Not Granted      Granted
                  │        │
                  ▼        │
    ┌──────────────────────┐│
    │ Request Permission   ││
    │ (Launch Settings)    ││
    └────────┬─────────────┘│
             │              │
        User grants         │
             │              │
             └──────┬───────┘
                    │
                    ▼
         ┌─────────────────────────┐
         │   All Permissions OK    │
         │  Service can be started │
         └─────────────────────────┘
```

## Data Flow

```
┌──────────────────────────────────────────────────────────────┐
│                   System Level                               │
│                                                              │
│  ┌────────────────┐          ┌──────────────────┐          │
│  │ UsageStatsManager│◄────────│ ActivityManager  │          │
│  │                │          │  (System Service)│          │
│  └────────┬───────┘          └──────────────────┘          │
│           │                                                  │
│           │ Tracks app usage                                │
│           │                                                  │
└───────────┼──────────────────────────────────────────────────┘
            │
            │ Query current app
            │
┌───────────▼──────────────────────────────────────────────────┐
│                   OverlayService                             │
│                                                              │
│  ┌─────────────────────────────────────────────────┐        │
│  │ Current App Detection                           │        │
│  │  • Query every 1 second                         │        │
│  │  • Compare package name                         │        │
│  │  • Trigger show/hide                            │        │
│  └────────┬─────────────────────────────────┬──────┘        │
│           │                                 │                │
│      Match: CR                         No Match             │
│           │                                 │                │
│  ┌────────▼──────────┐           ┌─────────▼────────┐      │
│  │  Show Overlay     │           │  Hide Overlay     │      │
│  │  • Inflate layout │           │  • Remove view    │      │
│  │  • Add to Window  │           │  • Clear reference│      │
│  └───────────────────┘           └───────────────────┘      │
└──────────────────────────────────────────────────────────────┘
```

## State Machine

```
                    ┌──────────────┐
                    │ App Installed│
                    └──────┬───────┘
                           │
                           ▼
                  ┌─────────────────┐
                  │ Permissions Not │
                  │    Granted      │
                  └────────┬────────┘
                           │
                      User grants
                           │
                           ▼
           ┌───────────────────────────────┐
           │     Service Stopped           │
           │  (Initial/Default State)      │
           └──────┬─────────────────┬──────┘
                  │                 │
        User taps │                 │ User taps
          Start   │                 │   Stop
                  │                 │
                  ▼                 │
           ┌──────────────┐         │
           │  Service     │         │
           │  Starting    │         │
           └──────┬───────┘         │
                  │                 │
                  ▼                 │
    ┌─────────────────────────┐    │
    │   Service Running       │    │
    │  (Monitoring Active)    │    │
    └─────┬──────────────┬────┘    │
          │              │          │
    CR Not │              │ CR      │
    Active │              │ Active  │
          │              │          │
          ▼              ▼          │
    ┌─────────┐    ┌─────────┐    │
    │ Overlay │    │ Overlay │    │
    │ Hidden  │◄──►│ Visible │    │
    └─────────┘    └─────────┘    │
          │              │          │
          └──────┬───────┘          │
                 │                  │
        User stops service          │
                 │                  │
                 └──────────────────┘
```

## Technology Stack

```
┌─────────────────────────────────────────────────────────┐
│                  Android Application                    │
│                                                         │
│  ┌───────────────────────────────────────────────────┐ │
│  │              Presentation Layer                    │ │
│  │  ┌─────────────────┐   ┌─────────────────┐       │ │
│  │  │   MainActivity  │   │  Overlay Layout │       │ │
│  │  │   (Activity)    │   │     (XML)       │       │ │
│  │  └─────────────────┘   └─────────────────┘       │ │
│  └───────────────────────────────────────────────────┘ │
│                                                         │
│  ┌───────────────────────────────────────────────────┐ │
│  │              Service Layer                        │ │
│  │  ┌─────────────────────────────────────────────┐ │ │
│  │  │         OverlayService                      │ │ │
│  │  │         (Foreground Service)                │ │ │
│  │  └─────────────────────────────────────────────┘ │ │
│  └───────────────────────────────────────────────────┘ │
│                                                         │
│  ┌───────────────────────────────────────────────────┐ │
│  │           Android Framework Layer                 │ │
│  │  ┌──────────────┐  ┌──────────────┐             │ │
│  │  │UsageStats    │  │WindowManager │             │ │
│  │  │Manager       │  │              │             │ │
│  │  └──────────────┘  └──────────────┘             │ │
│  │  ┌──────────────┐  ┌──────────────┐             │ │
│  │  │Notification  │  │AppOps        │             │ │
│  │  │Manager       │  │Manager       │             │ │
│  │  └──────────────┘  └──────────────┘             │ │
│  └───────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘

           ┌─────────────────────────────┐
           │    Build & Dependencies     │
           │                             │
           │  • Gradle 8.0               │
           │  • Android Gradle Plugin    │
           │  • AndroidX AppCompat       │
           │  • Material Design          │
           └─────────────────────────────┘
```
